<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Essay Analyzer</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script>
    const { useState, createElement: h } = React;
    
    // Icon components (same as before)
    const AlertCircle = ({ className }) => h('svg', { className, width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, 
      h('circle', { cx: 12, cy: 12, r: 10 }),
      h('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
      h('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
    );

    const CheckCircle = ({ className }) => h('svg', { className, width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14' }),
      h('polyline', { points: '22 4 12 14.01 9 11.01' })
    );

    const Flag = ({ className }) => h('svg', { className, width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z' }),
      h('line', { x1: 4, y1: 22, x2: 4, y2: 15 })
    );

    const Wrench = ({ className }) => h('svg', { className, width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z' })
    );

    const Loader2 = ({ className }) => h('svg', { className, width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M21 12a9 9 0 1 1-6.219-8.56' })
    );

    function EssayAnalyzer() {
      const [essay, setEssay] = useState('');
      const [essayType, setEssayType] = useState('academic');
      const [analysis, setAnalysis] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const analyzeEssay = async () => {
        if (!essay.trim()) {
          setError('Please enter an essay to analyze');
          return;
        }

        setLoading(true);
        setError('');
        setAnalysis(null);

        try {
          // Call your backend API instead of Anthropic directly
          const response = await fetch('/api/analyze', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              essay: essay,
              essayType: essayType
            })
          });

          if (!response.ok) {
            throw new Error('Analysis failed');
          }

          const data = await response.json();
          setAnalysis(data);
        } catch (err) {
          setError('Failed to analyze essay. Please try again. Error: ' + err.message);
          console.error(err);
        } finally {
          setLoading(false);
        }
      };

      const getLikelihoodColor = (likelihood) => {
        switch(likelihood) {
          case 'low': return 'text-green-600 bg-green-50 border-green-200';
          case 'medium': return 'text-yellow-600 bg-yellow-50 border-yellow-200';
          case 'high': return 'text-red-600 bg-red-50 border-red-200';
          default: return 'text-gray-600 bg-gray-50 border-gray-200';
        }
      };

      const getProgressColor = (percentage) => {
        if (percentage < 30) return 'bg-green-500';
        if (percentage < 60) return 'bg-yellow-500';
        return 'bg-red-500';
      };

      return h('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6" },
        h('div', { className: "max-w-4xl mx-auto" },
          h('div', { className: "bg-white rounded-2xl shadow-xl p-8 mb-6" },
            h('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, 'Essay Analyzer'),
            h('p', { className: "text-gray-600 mb-6" }, 'Get AI-powered feedback on your essay'),

            h('div', { className: "mb-4" },
              h('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Essay Type'),
              h('select', {
                value: essayType,
                onChange: (e) => setEssayType(e.target.value),
                className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              },
                h('option', { value: "academic" }, 'Academic Essay'),
                h('option', { value: "university" }, 'University Application Essay')
              )
            ),

            h('div', { className: "mb-4" },
              h('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Paste Your Essay'),
              h('textarea', {
                value: essay,
                onChange: (e) => setEssay(e.target.value),
                placeholder: "Paste your essay here...",
                className: "w-full h-64 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
              }),
              h('p', { className: "text-sm text-gray-500 mt-2" },
                essay.split(/\s+/).filter(w => w).length + ' words'
              )
            ),

            error && h('div', { className: "mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700" }, error),

            h('button', {
              onClick: analyzeEssay,
              disabled: loading,
              className: "w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            },
              loading ? [
                h(Loader2, { key: 'loader', className: "w-5 h-5 animate-spin" }),
                'Analyzing...'
              ] : 'Analyze Essay'
            )
          ),

          analysis && h('div', { className: "space-y-6" },
            h('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
              h('h2', { className: "text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2" },
                h(AlertCircle, { className: "w-6 h-6" }),
                'AI Detection Analysis'
              ),
              
              h('div', { className: "grid md:grid-cols-2 gap-6 mb-6" },
                h('div', { className: "text-center p-6 bg-gray-50 rounded-xl border-2 border-gray-200" },
                  h('p', { className: "text-sm text-gray-600 mb-2" }, 'AI Probability'),
                  h('p', { className: "text-5xl font-bold text-gray-800 mb-2" },
                    analysis.aiDetection.aiProbability + '%'
                  ),
                  h('div', { className: "w-full bg-gray-200 rounded-full h-3 overflow-hidden" },
                    h('div', {
                      className: `h-full ${getProgressColor(analysis.aiDetection.aiProbability)} transition-all duration-500`,
                      style: { width: `${analysis.aiDetection.aiProbability}%` }
                    })
                  )
                ),

                h('div', { className: "text-center p-6 bg-gray-50 rounded-xl border-2 border-gray-200" },
                  h('p', { className: "text-sm text-gray-600 mb-2" }, 'Confidence Score'),
                  h('p', { className: "text-5xl font-bold text-blue-600 mb-2" },
                    analysis.aiDetection.confidenceScore + '%'
                  ),
                  h('div', { className: "w-full bg-gray-200 rounded-full h-3 overflow-hidden" },
                    h('div', {
                      className: "h-full bg-blue-500 transition-all duration-500",
                      style: { width: `${analysis.aiDetection.confidenceScore}%` }
                    })
                  )
                )
              ),

              h('div', { className: `p-5 rounded-xl border-2 mb-4 ${getLikelihoodColor(analysis.aiDetection.likelihood)}` },
                h('p', { className: "font-bold text-lg mb-2" },
                  'Assessment: ' + analysis.aiDetection.likelihood.toUpperCase()
                ),
                h('p', { className: "text-sm leading-relaxed" }, analysis.aiDetection.reasoning)
              ),

              h('div', { className: "bg-gray-50 p-5 rounded-xl border border-gray-200" },
                h('p', { className: "font-semibold text-gray-800 mb-3" }, 'AI Indicators Detected:'),
                h('ul', { className: "space-y-2" },
                  analysis.aiDetection.indicators.map((indicator, idx) =>
                    h('li', { key: idx, className: "flex gap-2 text-sm text-gray-700" },
                      h('span', { className: "text-gray-400" }, '▸'),
                      h('span', null, indicator)
                    )
                  )
                )
              )
            ),

            h('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
              h('h2', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
                h(CheckCircle, { className: "w-6 h-6 text-green-600" }),
                'Strengths'
              ),
              h('ul', { className: "space-y-3" },
                analysis.strengths.map((strength, idx) =>
                  h('li', { key: idx, className: "flex gap-3" },
                    h('span', { className: "text-green-600 font-bold" }, '•'),
                    h('span', { className: "text-gray-700" }, strength)
                  )
                )
              )
            ),

            h('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
              h('h2', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
                h(AlertCircle, { className: "w-6 h-6 text-orange-600" }),
                'Weaknesses'
              ),
              h('ul', { className: "space-y-3" },
                analysis.weaknesses.map((weakness, idx) =>
                  h('li', { key: idx, className: "flex gap-3" },
                    h('span', { className: "text-orange-600 font-bold" }, '•'),
                    h('span', { className: "text-gray-700" }, weakness)
                  )
                )
              )
            ),

            h('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
              h('h2', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
                h(Flag, { className: "w-6 h-6 text-red-600" }),
                'Red Flags'
              ),
              h('ul', { className: "space-y-3" },
                analysis.flags.map((flag, idx) =>
                  h('li', { key: idx, className: "flex gap-3" },
                    h('span', { className: "text-red-600 font-bold" }, '•'),
                    h('span', { className: "text-gray-700" }, flag)
                  )
                )
              )
            ),

            h('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
              h('h2', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
                h(Wrench, { className: "w-6 h-6 text-blue-600" }),
                'How to Fix & Improve'
              ),
              h('ul', { className: "space-y-3" },
                analysis.fixes.map((fix, idx) =>
                  h('li', { key: idx, className: "flex gap-3" },
                    h('span', { className: "text-blue-600 font-bold" }, (idx + 1) + '.'),
                    h('span', { className: "text-gray-700" }, fix)
                  )
                )
              )
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(h(EssayAnalyzer));
  </script>
</body>
</html>